# Руководство разработчика GrowBox

## Содержание
1. [Начало работы](#начало-работы)
2. [Структура проекта](#структура-проекта)
3. [Стиль кода](#стиль-кода)
4. [Работа с датчиками](#работа-с-датчиками)
5. [Добавление новых функций](#добавление-новых-функций)
6. [Тестирование](#тестирование)
7. [Отладка](#отладка)
8. [Версионирование](#версионирование)
9. [Вклад в проект](#вклад-в-проект)

## Начало работы

### Требования

- PlatformIO Core 6.1 или выше
- Python 3.8+
- ESP-IDF 4.4+
- Git

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/growbox-esp32.git
   cd growbox-esp32
   ```

2. Установите зависимости:
   ```bash
   pio pkg install
   ```

3. Настройте среду разработки в вашей IDE:
   - VS Code с расширением PlatformIO
   - CLion с плагином PlatformIO
   - Другая среда по вашему выбору

## Структура проекта

```
growbox-esp32/
├── data/                 # Файлы для LittleFS
├── docs/                 # Документация
├── include/              # Заголовочные файлы
├── lib/                  # Внешние библиотеки
├── src/                  # Исходный код
│   ├── main/             # Основной код приложения
│   ├── sensors/          # Драйверы датчиков
│   ├── network/          # Сетевые функции
│   ├── web/              # Веб-интерфейс
│   └── utils/            # Вспомогательные утилиты
├── test/                 # Тесты
├── platformio.ini        # Конфигурация PlatformIO
└── README.md             # Основная документация
```

## Стиль кода

### Форматирование

- Отступы: 2 пробела
- Максимальная длина строки: 100 символов
- Фигурные скобки на той же строке

### Именование

- Переменные: `snake_case`
- Константы: `UPPER_SNAKE_CASE`
- Функции: `camelCase`
- Классы: `PascalCase`
- Файлы: `snake_case`

### Комментарии

- Используйте комментарии для объяснения "почему", а не "как"
- Документируйте публичные API с помощью Doxygen
- Обновляйте комментарии при изменении кода

## Работа с датчиками

### Добавление нового датчика

1. Создайте класс датчика в `src/sensors/`
2. Реализуйте интерфейс `BaseSensor`
3. Добавьте конфигурацию в `config/sensors.h`
4. Зарегистрируйте датчик в `main.cpp`

### Пример датчика

```cpp
// sensors/example_sensor.h
#pragma once
#include "base_sensor.h"

class ExampleSensor : public BaseSensor {
public:
    ExampleSensor();
    bool begin() override;
    void update() override;
    float getValue() const override;
    const char* getName() const override { return "example"; }
    
private:
    float value = 0.0f;
};
```

## Добавление новых функций

### Процесс разработки

1. Создайте ветку для новой функции:
   ```bash
   git checkout -b feature/new-awesome-feature
   ```

2. Реализуйте изменения
3. Напишите тесты
4. Обновите документацию
5. Создайте pull request

### Требования к коду

- Код должен быть покрыт тестами
- Документируйте публичные API
- Следуйте принципам SOLID
- Избегайте циклических зависимостей

## Тестирование

### Запуск тестов

```bash
# Все тесты
pio test

# Конкретный тест
pio test -e native -t test_specific
```

### Написание тестов

1. Создайте тестовый файл в `test/`
2. Используйте Unity в качестве фреймворка
3. Тестируйте один аспект за раз
4. Используйте моки для внешних зависимостей

## Отладка

### Логирование

Используйте макросы логирования:

```cpp
LOG_I("Информационное сообщение");
LOG_D("Отладочное сообщение: %d", value);
LOG_W("Предупреждение: %s", message);
LOG_E("Ошибка: %s", error);
```

### Отладка через последовательный порт

1. Подключитесь к последовательному порту:
   ```bash
   pio device monitor -p /dev/ttyUSB0 -b 115200
   ```

2. Используйте команды отладки:
   ```
   help       - Показать доступные команды
   heap       - Показать свободную память
   tasks      - Показать список задач
   loglevel X - Установить уровень логирования (0-4)
   ```

## Версионирование

Следуем [Semantic Versioning](https://semver.org/lang/ru/):

- MAJOR: обратно несовместимые изменения
- MINOR: обратно совместимые новые функции
- PATCH: обратно совместимые исправления ошибок

### Создание релиза

1. Обновите версию в `platformio.ini`
2. Обновите `CHANGELOG.md`
3. Создайте тег:
   ```bash
   git tag -a v1.0.0 -m "Версия 1.0.0"
   git push origin v1.0.0
   ```
4. Создайте релиз на GitHub

## Вклад в проект

### Отправка исправлений

1. Форкните репозиторий
2. Создайте ветку для вашего исправления
3. Сделайте коммит с понятным сообщением
4. Отправьте pull request

### Ревью кода

- Проверяйте свой код перед отправкой
- Оставляйте конструктивные комментарии
- Уважайте мнение других участников

### Стандарты коммитов

Формат сообщения коммита:

```
тип(область): краткое описание

Подробное описание изменений

Closes #номер-задачи
```

Допустимые типы:
- feat: новая функция
- fix: исправление ошибки
- docs: изменения в документации
- style: форматирование, отсутствующие точки с запятой и т.д.
- refactor: рефакторинг кода
- test: добавление тестов
- chore: обновление задач сборки, настройки пакетного менеджера и т.д.

## Производительность

### Оптимизация памяти

- Используйте статические буферы, где это возможно
- Избегайте динамического выделения памяти в циклах
- Используйте `constexpr` для констант времени компиляции

### Производительность в реальном времени

- Критический код должен быть быстрым
- Избегайте блокирующих вызовов в циклах
- Используйте прерывания для временнó-критичных операций

## Безопасность

### Рекомендации

- Никогда не храните пароли в коде
- Используйте безопасные функции для работы со строками
- Проверяйте входные данные
- Обновляйте зависимости

### Аудит безопасности

Перед выпуском новой версии выполните:

1. Статический анализ кода
2. Проверку на утечки памяти
3. Тестирование на переполнение буфера
4. Аудит зависимостей

## Дополнительные ресурсы

- [Документация ESP-IDF](https://docs.espressif.com/projects/esp-idf/)
- [Руководство по PlatformIO](https://docs.platformio.org/)
- [Рекомендации по стилю кода ESP-IDF](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/contribute/style-guide.html)
