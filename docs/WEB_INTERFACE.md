# Руководство по веб-интерфейсу GrowBox

## Содержание
1. [Обзор](#обзор)
2. [Быстрый старт](#быстрый-старт)
3. [Главный экран](#главный-экран)
4. [Меню навигации](#меню-навигации)
5. [Настройки системы](#настройки-системы)
6. [API](#api)
7. [Устранение неисправностей](#устранение-неисправностей)

## Обзор

Веб-интерфейс GrowBox - это адаптивный веб-приложение, работающее на ESP32 с использованием AsyncWebServer и WebSockets. Интерфейс предоставляет:

- Мониторинг показаний датчиков в реальном времени
- Управление реле и исполнительными устройствами
- Настройку системы и калибровку датчиков
- Просмотр графиков и истории измерений
- Управление через API

## Быстрый старт

1. **Первое включение**
   - По умолчанию устройство создаёт точку доступа `GrowBox-XXXXXX`
   - Пароль по умолчанию: `growbox123`
   - Подключитесь к сети и откройте `http://192.168.4.1`

2. **Настройка WiFi**
   - Перейдите в раздел "Настройки" > "Сеть"
   - Выберите вашу WiFi сеть и введите пароль
   - Нажмите "Сохранить" и перезагрузите устройство

3. **Доступ к веб-интерфейсу**
   - После подключения к вашей сети, откройте `http://growbox.local`
   - Или используйте IP-адрес из логов последовательного порта

## Главный экран

### Панель состояния

- **Состояние системы**
  - Версия прошивки
  - Время работы
  - Загрузка CPU
  - Свободная память

- **Показания датчиков**
  - Температура и влажность
  - pH и EC раствора
  - Уровень воды
  - Освещённость

- **Управление**
  - Кнопки включения/выключения реле
  - Ручной режим управления
  - Статус автоматики

### Виджеты

- **Графики** - миниатюры графиков основных параметров
- **Уведомления** - системные сообщения и предупреждения
- **Быстрый доступ** - часто используемые функции

## Меню навигации

### Главная
- Сводная информация о системе
- Быстрый доступ к основным функциям

### Мониторинг
- Таблицы текущих значений
- Графики в реальном времени
- Журнал событий

### Управление
- Ручное управление реле
- Настройка автоматики
- Расписания работы

### Настройки
- **Сеть** - WiFi, MQTT, NTP
- **Датчики** - калибровка, интервалы опроса
- **Интерфейс** - темы, язык, единицы измерения
- **Система** - обновление, резервное копирование, перезагрузка

### Администрирование
- Пользователи и права доступа
- Логи системы
- Отладка

## Настройки системы

### Сеть
- **WiFi**
  - Режим (Клиент/Точка доступа)
  - Сканирование и подключение к сетям
  - Настройка статического IP

- **MQTT**
  - Адрес и порт брокера
  - Аутентификация
  - Автообнаружение Home Assistant

- **NTP**
  - Сервер времени
  - Часовой пояс
  - Летнее время

### Датчики
- **Калибровка**
  - Температура и влажность
  - pH и EC
  - Уровень воды

- **Интервалы опроса**
  - Основные датчики
  - Дополнительные сенсоры
  - Частота обновления веб-интерфейса

### Интерфейс
- **Тема**
  - Светлая/тёмная тема
  - Цветовая схема
  - Шрифты

- **Единицы измерения**
  - Температура (°C/°F)
  - Давление (hPa/mmHg)
  - Расход (л/мин, галлонов/час)

## API

### Базовый URL
```
http://<IP-адрес>/api/v1/
```

### Аутентификация

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "пароль"
}
```

### Получение данных

```http
GET /api/v1/sensors
Authorization: Bearer <токен>
```

**Ответ:**
```json
{
  "temperature": 25.4,
  "humidity": 65.2,
  "ph": 6.2,
  "ec": 1.8,
  "water_level": 75,
  "light": 45000,
  "timestamp": 1678901234
}
```

### Управление реле

```http
POST /api/v1/relay/1
Authorization: Bearer <токен>
Content-Type: application/json

{
  "state": "on"
}
```

### Получение настроек

```http
GET /api/v1/settings
Authorization: Bearer <токен>
```

### Обновление настроек

```http
POST /api/v1/settings
Authorization: Bearer <токен>
Content-Type: application/json

{
  "wifi_ssid": "MyWiFi",
  "wifi_password": "secret",
  "mqtt_enabled": true,
  "mqtt_server": "mqtt.example.com"
}
```

## Устранение неисправностей

### Веб-интерфейс не загружается
1. Проверьте подключение к сети
2. Очистите кеш браузера (Ctrl+F5)
3. Проверьте логи через последовательный порт

### Нет обновления данных
1. Убедитесь, что WebSocket подключен (индикатор в правом нижнем углу)
2. Проверьте настройки интервала обновления
3. Перезагрузите страницу

### Ошибки авторизации
1. Проверьте логин и пароль
2. Убедитесь, что учётная запись активна
3. Проверьте настройки прав доступа

### Медленная работа интерфейса
1. Уменьшите частоту обновления
2. Отключите неиспользуемые виджеты
3. Проверьте загрузку процессора и памяти

### Восстановление доступа
1. Нажмите и удерживайте кнопку BOOT при включении
2. Дождитесь сброса настроек
3. Подключитесь к точке доступа по умолчанию
{
  "temperature": 24.5,
  "humidity": 65.2,
  "ph": 6.2,
  "ec": 1200,
  "water_level": 85,
  "timestamp": "2023-04-15T14:30:00Z"
}
```

#### Управление реле

```http
POST /api/v1/relay
Content-Type: application/json

{
  "id": 1,
  "state": true
}
```

#### Получение настроек

```http
GET /api/v1/settings
```

## Устранение неисправностей

### Проблема: Не загружается веб-интерфейс
- Проверьте подключение к сети
- Убедитесь, что устройство включено
- Попробуйте очистить кеш браузера

### Проблема: Нет данных с датчиков
- Проверьте подключение датчиков
- Убедитесь, что датчики включены в настройках
- Проверьте логи на наличие ошибок

### Проблема: Не сохраняются настройки
- Проверьте права доступа к файловой системе
- Убедитесь, что есть свободное место
- Перезагрузите устройство

## Безопасность

### Аутентификация

По умолчанию веб-интерфейс защищён паролем. 

**Логин:** admin  
**Пароль:** (устанавливается при первом запуске)

### Рекомендации по безопасности

1. Смените пароль по умолчанию
2. Используйте HTTPS при доступе из интернета
3. Ограничьте доступ к веб-интерфейсу по IP-адресу
4. Регулярно обновляйте прошивку

## Мобильное приложение

Для удобного доступа с мобильных устройств можно использовать:

1. **Веб-приложение** - откройте веб-интерфейс в мобильном браузере
2. **Домашний экран** - добавьте иконку на главный экран
3. **Сторонние приложения** - используйте MQTT-клиенты для интеграции

## Логи

Журнал событий доступен в разделе "Система" > "Логи". Вы можете:

- Просматривать события в реальном времени
- Фильтровать по типу (ошибка, предупреждение, информация)
- Экспортировать логи для анализа

## Резервное копирование

Рекомендуется регулярно создавать резервные копии настроек:

1. Перейдите в "Настройки" > "Резервная копия"
2. Нажмите "Создать резервную копию"
3. Сохраните файл в безопасное место

Для восстановления:

1. Перейдите в "Настройки" > "Резервная копия"
2. Нажмите "Восстановить из файла"
3. Выберите файл с резервной копией
4. Подтвердите восстановление

## Поддержка

По всем вопросам обращайтесь:
- В раздел "Помощь" в веб-интерфейсе
- На форум поддержки
- По электронной почте support@growbox.local
